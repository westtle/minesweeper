let board=[],tilesClicked=0;const row=9,column=9;let mines=10,minesLocation=[],flagMode=!1,gameStarted=!1;const boardDiv=document.querySelector(".__board"),flagButton=document.querySelector("._flag"),minesCounter=document.querySelector("._mines-count"),timerDiv=document.querySelector(".__timer"),smileyFace=document.querySelector("._smiley-face");function loadBoard(){for(let e=0;e<9;e++)for(let n=0;n<9;n++){let i=document.createElement("div");i.id=`${e}-${n}`,i.classList.add("_tile"),i.addEventListener("click",clickTile),i.addEventListener("contextmenu",placeFlag),i.addEventListener("mousedown",faceWhenHold),i.addEventListener("mouseup",faceWhenReleaseHold),boardDiv.append(i),board.push(`${e}-${n}`)}flagButton.addEventListener("click",setFlagMode),loadMines()}function loadMines(){for(let e=0;e<=9;e++){let n=Math.floor(9*Math.random()),i=Math.floor(9*Math.random());!minesLocation.includes(`${n}-${i}`)&&(minesLocation.push(`${n}-${i}`),minesLocation.splice(10,11),minesLocation.length<10&&loadMines())}}function setFlagMode(){flagMode?(flagMode=!1,flagButton.classList.remove("flag-clicked"),boardDiv.childNodes.forEach(e=>e.addEventListener("mousedown",faceWhenHold)),boardDiv.childNodes.forEach(e=>e.addEventListener("mouseup",faceWhenReleaseHold))):(flagMode=!0,flagButton.classList.add("flag-clicked"),boardDiv.childNodes.forEach(e=>e.removeEventListener("mousedown",faceWhenHold)),boardDiv.childNodes.forEach(e=>e.removeEventListener("mouseup",faceWhenReleaseHold)))}function placeFlag(e,n=this){null!==e&&e.preventDefault();let i=document.createElement("img");i.src="assets/Images/flag.svg",n.contains(n.querySelector("img"))||n.classList.contains("clicked")?n.contains(n.querySelector("img"))&&(n.innerHTML="",mines+=1):(n.innerHTML="",n.append(i),mines-=1),minesCounter.innerText=mines}function clickTile(){if(gameStarted||(gameStarted=!0,startTimer()),flagMode){placeFlag(null,this);return}minesLocation.forEach(e=>{if(this.id===e&&!this.contains(this.querySelector("img"))){gameStarted=!1,revealMines(),endGame(this);return}});let e=this.id.split("-");checkMine(e[0],e[1])}function checkMine(e,n){let i=Number(e),t=Number(n);if(i<0||i>=9||t<0||t>=9)return;let c=document.getElementById(`${i}-${t}`);if(c.classList.contains("clicked")||c.contains(c.querySelector("img")))return;c.classList.add("clicked");let o=0;if(tilesClicked+=1,o+=checkSurrounding(i-1,t-1),o+=checkSurrounding(i-1,t),o+=checkSurrounding(i-1,t+1),o+=checkSurrounding(i,t-1),o+=checkSurrounding(i,t+1),o+=checkSurrounding(i+1,t-1),o+=checkSurrounding(i+1,t),(o+=checkSurrounding(i+1,t+1))>0){if(c.contains(c.querySelector("img")))return;c.innerText=o}else checkMine(i-1,t-1),checkMine(i-1,t),checkMine(i-1,t+1),checkMine(i,t-1),checkMine(i,t+1),checkMine(i+1,t-1),checkMine(i+1,t),checkMine(i+1,t+1);winGame()}function checkSurrounding(e,n){return e<0||e>=9||n<0||n>=9?0:minesLocation.includes(`${e}-${n}`)?1:0}function revealMines(){let e=document.createElement("img");e.src="assets/Images/sun.svg",minesLocation.forEach(n=>{let i=document.getElementById(n);i.innerHTML="",i.append(e.cloneNode()),i.classList.add("clicked")})}function endGame(e){e.classList.remove("clicked"),e.style.background="rgba(255, 0, 0, 0.4)",flagButton.removeEventListener("click",setFlagMode),boardDiv.childNodes.forEach(e=>e.removeEventListener("click",clickTile)),boardDiv.childNodes.forEach(e=>e.removeEventListener("contextmenu",placeFlag)),boardDiv.childNodes.forEach(e=>e.removeEventListener("mousedown",faceWhenHold)),boardDiv.childNodes.forEach(e=>e.removeEventListener("mouseup",faceWhenReleaseHold)),smileyFace.innerText=":("}function winGame(){71===tilesClicked&&(smileyFace.innerText=":D",flagButton.removeEventListener("click",setFlagMode),boardDiv.childNodes.forEach(e=>e.removeEventListener("click",clickTile)),boardDiv.childNodes.forEach(e=>e.removeEventListener("contextmenu",placeFlag)),boardDiv.childNodes.forEach(e=>e.removeEventListener("mousedown",faceWhenHold)),boardDiv.childNodes.forEach(e=>e.removeEventListener("mouseup",faceWhenReleaseHold)),gameStarted=!1,revealMines())}function resetGame(){tilesClicked=0,mines=10,minesCounter.innerText=mines,minesLocation=[],boardDiv.innerHTML="",smileyFace.innerText=":)",gameStarted=!1,setTimeout(()=>timerDiv.innerText="000",1e3),loadBoard()}function startTimer(){let e=0,n=setInterval(()=>{(e+=1)<10?timerDiv.innerText=`00${e}`:e<100?timerDiv.innerText=`0${e}`:e<1e3&&(timerDiv.innerText=e),gameStarted&&-999!=e||clearInterval(n)},1e3)}function faceWhenHold(){smileyFace.innerText=":o"}function faceWhenReleaseHold(){smileyFace.innerText=":)"}smileyFace.addEventListener("click",resetGame),document.addEventListener("DOMContentLoaded",()=>{loadBoard()});