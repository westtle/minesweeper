let board=[],tilesClicked=0,gameRow=9,gameColumn=9,mines=10,minesLeft=mines,minesLocation=[],gameStarted=!1,difficulty="Beginner";const boardHTML=document.querySelector(".__board"),timerHTML=document.querySelector("._timer"),smileyFace=document.querySelector("._smiley-face"),gameTabButton=document.querySelector(".__game ._game-text"),helpTabButton=document.querySelector(".__help ._help-text"),newGameButton=document.querySelector(".new-game_"),difficultyButtons={beginnerButton:document.querySelector(".beginner_"),intermediateButton:document.querySelector(".intermediate_"),expertButton:document.querySelector(".expert_"),customButton:document.querySelector(".custom_")};function loadBoard(){for(let e=0;e<gameRow;e++)for(let t=0;t<gameColumn;t++){let a=document.createElement("div");a.id=`${e}-${t}`,a.classList.add("_tile"),a.dataset.flagged=!1,a.addEventListener("click",clickTile),a.addEventListener("contextmenu",placeFlag),holdEffect(a,"hold_"),boardHTML.append(a),board.push(`${e}-${t}`)}boardHTML.style.pointerEvents="auto",updateDigit("._mines-count",minesLeft),loadMines()}function loadMines(){for(let e=0;e<mines;e++){let t=Math.floor(Math.random()*gameRow),a=Math.floor(Math.random()*gameColumn);!minesLocation.includes(`${t}-${a}`)&&(minesLocation.push(`${t}-${a}`),minesLocation.splice(mines,mines+1),minesLocation.length<mines&&loadMines())}}function difficultySet(e,t){difficulty=e.dataset.difficulty,Object.keys(difficultyButtons).forEach(e=>difficultyButtons[e].querySelector("img").dataset.checked="false"),e.querySelector("img").dataset.checked="true","Beginner"==difficulty?(gameRow=9,gameColumn=9,mines=10):"Intermediate"==difficulty?(gameRow=16,gameColumn=16,mines=40):"Expert"==difficulty?(gameRow=16,gameColumn=30,mines=99):"Custom"==difficulty&&(gameRow=t.width,gameColumn=t.height,mines=t.mines),document.querySelector("main").style.maxWidth=`calc(${gameColumn} * 1rem + 0.125rem)`,boardHTML.style.gridTemplateColumns=`repeat(${gameColumn}, 1fr)`,boardHTML.style.gridTemplateRows=`repeat(${gameRow}, 1fr)`,resetGame()}function clickTile(){if(gameStarted||(gameStarted=!0,startTimer()),"flagged"==this.dataset.flagged)return;minesLocation.forEach(e=>{if(this.id===e&&!this.classList.contains("mine_")){gameStarted=!1,revealMines(),endGame(this);return}});let e=this.id.split("-");checkMine(e[0],e[1])}function checkMine(e,t){let a=Number(e),n=Number(t);if(a<0||a>=gameRow||n<0||n>=gameColumn)return;let i=document.getElementById(`${a}-${n}`);if(i.classList.contains("clicked_")||i.classList.contains("mine_"))return;i.classList.add("clicked_");let o=0;if(tilesClicked+=1,o+=checkSurrounding(a-1,n-1),o+=checkSurrounding(a-1,n),o+=checkSurrounding(a-1,n+1),o+=checkSurrounding(a,n-1),o+=checkSurrounding(a,n+1),o+=checkSurrounding(a+1,n-1),o+=checkSurrounding(a+1,n),(o+=checkSurrounding(a+1,n+1))>0){if(i.contains(i.querySelector("img")))return;i.classList.add(`t${o}_`)}else checkMine(a-1,n-1),checkMine(a-1,n),checkMine(a-1,n+1),checkMine(a,n-1),checkMine(a,n+1),checkMine(a+1,n-1),checkMine(a+1,n),checkMine(a+1,n+1);i.classList.contains("question-mark_")&&i.classList.remove("question-mark_"),winGame()}function checkSurrounding(e,t){return e<0||e>=gameRow||t<0||t>=gameColumn?0:minesLocation.includes(`${e}-${t}`)?1:0}function revealMines(){minesLocation.forEach(e=>{let t=document.getElementById(e);t.classList.remove("question-mark_"),t.classList.add("mine_"),"flagged"==t.dataset.flagged&&(t.classList.remove("flagged_"),t.classList.add("mine-flagged_"))})}function endGame(e){e.classList.add("mine-clicked_"),boardHTML.style.pointerEvents="none",smileyFace.classList.add("face-lose_")}function winGame(){tilesClicked==gameRow*gameColumn-mines&&(gameStarted=!1,boardHTML.style.pointerEvents="none",smileyFace.classList.add("face-win_"),revealMines())}function resetGame(){tilesClicked=0,minesLeft=mines,minesLocation=[],boardHTML.innerHTML="",smileyFace.classList.remove("face-win_","face-lose_"),gameStarted=!1,setTimeout(()=>Array.from(timerHTML.children).forEach(e=>e.dataset.number="zero_"),1e3),loadBoard()}function placeFlag(e,t=this){null!==e&&e.preventDefault(),"false"!=t.dataset.flagged||t.classList.contains("clicked_")?"flagged"==t.dataset.flagged?(t.classList.remove("flagged_"),t.classList.add("question-mark_"),t.dataset.flagged="question-mark",minesLeft+=1):"question-mark"==t.dataset.flagged&&(t.classList.remove("question-mark_"),t.dataset.flagged=!1):(t.classList.add("flagged_"),t.dataset.flagged="flagged",minesLeft-=1),updateDigit("._mines-count",minesLeft)}function startTimer(){let e="000",t=0,a=setInterval(()=>{++t<10?e=`00${t}`:t<100?e=`0${t}`:t<1e3&&(e=t),updateDigit("._timer",t),gameStarted&&999!=t||clearInterval(a)},1e3)}function updateDigit(e,t){let a;t<10?a=`00${t}`:t<100?a=`0${t}`:t<1e3&&(a=t.toString());let n=toWord(a.split("")[0]),i=document.querySelector(`${e} .left_`);i.dataset.number=`${n}_`;let o=toWord(a.split("")[1]),s=document.querySelector(`${e} .middle_`);s.dataset.number=`${o}_`;let c=toWord(a.split("")[2]),l=document.querySelector(`${e} .right_`);l.dataset.number=`${c}_`}function toWord(e){return["zero","one","two","three","four","five","six","seven","eight","nine"][e]}function faceWhenHold(){smileyFace.classList.add("face-o_")}function faceWhenReleaseHold(){smileyFace.classList.remove("face-o_")}function holdEffect(e,t){e.addEventListener("mousedown",a=>{"hold_"==t&&faceWhenHold(),(1==a.buttons||3==a.buttons)&&e.classList.add(t)}),e.addEventListener("mouseover",a=>{(1==a.buttons||3==a.buttons)&&e.classList.add(t)}),e.addEventListener("mouseup",()=>{"hold_"==t&&faceWhenReleaseHold(),e.classList.remove(t)}),e.addEventListener("mouseout",()=>e.classList.remove(t))}function openTab(e){e.parentElement.querySelector("._options").classList.toggle("active_"),e.classList.toggle("active-tab_")}function getCustomValue(){do var e=parseInt(window.prompt("Width (Max: 30 min: 9):",""),10);while(isNaN(e)||e>30||e<9);do var t=parseInt(window.prompt("Height (Max: 24 min: 9):",""),10);while(isNaN(t)||t>24||t<9);do var a=parseInt(window.prompt("Mines (Max: 667 min: 10):",""),10);while(isNaN(a)||a>667||a<10);return{width:e,height:t,mines:a}}smileyFace.addEventListener("click",resetGame),gameTabButton.addEventListener("click",()=>openTab(gameTabButton)),helpTabButton.addEventListener("click",()=>openTab(helpTabButton)),newGameButton.addEventListener("click",()=>{resetGame(),openTab(gameTabButton)}),Object.keys(difficultyButtons).forEach(e=>{difficultyButtons[e].addEventListener("click",()=>{if("customButton"==e){difficultySet(difficultyButtons.customButton,getCustomValue());return}difficultySet(difficultyButtons[e]),openTab(gameTabButton)})}),document.addEventListener("click",e=>{e.target!=gameTabButton&&e.target!=document.querySelector("._options")&&e.target!=document.querySelector(".separator_")&&e.target!=gameTabButton.querySelector("u")&&gameTabButton.classList.contains("active-tab_")&&openTab(gameTabButton),e.target!=helpTabButton&&e.target!=document.querySelector("._options")&&e.target!=document.querySelector(".separator_")&&e.target!=helpTabButton.querySelector("u")&&helpTabButton.classList.contains("active-tab_")&&openTab(helpTabButton)}),document.addEventListener("DOMContentLoaded",()=>{loadBoard(),holdEffect(smileyFace,"face-hold_")});